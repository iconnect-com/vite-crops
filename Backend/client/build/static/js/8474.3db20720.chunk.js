"use strict";(self.webpackChunkcommodityvirtualdashboard=self.webpackChunkcommodityvirtualdashboard||[]).push([[8474],{98474:(e,t,i)=>{i.r(t),i.d(t,{default:()=>b});var l=i(65043),n=i(48649),d=i(87021),a=i(25589),s=i(52536),o=i(11645),r=i(62423),c=i(73216),m=i(44326),x=i(33563),f=i(37762),h=i(65239),u=i.n(h),p=i(50867),v=i(17586),y=i(72450),g=i(11238),w=i(70579);const j=()=>{const{data:e}=(0,p.kI)(),{publicCommodities:t}=(0,l.useContext)(x.y),i=null===e||void 0===e?void 0:e.map(((e,t)=>({...e,index:t}))),[n,h]=(0,l.useState)(0),[j,b]=(0,l.useState)(!1),[_,k]=(0,l.useState)([]),[S,A]=(0,l.useState)("pdf"),[E,C]=(0,l.useState)(!1),[N,I]=(0,l.useState)([]),[D,M]=(0,l.useState)([]),[F,R]=(0,l.useState)(void 0),[W,z]=(0,l.useState)(void 0),[B,O]=(0,l.useState)(void 0);null===t||void 0===t||t[n];(0,l.useEffect)((()=>{n&&O((()=>{const e=null===t||void 0===t?void 0:t.find((e=>e._id===String(n)));return null===e||void 0===e?void 0:e.name})())}),[n]);const T=["January","February","March","April","May","June","July","August","September","October","November","December"],P=Array.from(new Set(null===i||void 0===i?void 0:i.map((e=>new Date(e.effective_date).getFullYear())))),J=Array.from(new Set(null===i||void 0===i?void 0:i.map((e=>T[new Date(e.effective_date).getMonth()])))),L=(0,c.Zp)();(0,l.useEffect)((()=>{E&&(Y(),C(!1))}),[E]);const Y=async()=>{if(n)if("pdf"===S){const t=new f.uE("p","mm","a4"),i=t.internal.pageSize.getWidth(),l=t.internal.pageSize.getHeight(),n=async(e,n,d)=>{const a=document.getElementById(e);if(a){const e=await u()(a),s=e.toDataURL("image/png"),o=i/e.width,r=l/e.height,c=Math.min(o,r),m=e.width*c-20,x=e.height*c-20;t.setFontSize(16),t.text("Commodity Report",i/2,20,{align:"center"}),t.setFontSize(12),t.text("Commodity Name: ".concat(B),10,30,{align:"left"});const f=d+40;return t.addImage(s,"PNG",n,f,m,x),x}};try{await new Promise((e=>setTimeout(e,1e3)));const e=await n("line-chart",7,30);e&&await n("table",10,e+20),t.save("download.pdf")}catch(e){(0,v.n7)("Error while exporting")}}else if("xlsx"===S)try{const e=null===i||void 0===i?void 0:i.filter((e=>e.commodity._id===n)),t=g.Wp.aoa_to_sheet(e.map((e=>[e.number,e.commodity.name,e.new_price,e.effective_date]))),l=g.Wp.book_new();g.Wp.book_append_sheet(l,t,"CommodityData");const d=g.M9(l,{bookType:"xlsx",type:"buffer"}),a=new Blob([d],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=UTF-8"});(0,y.saveAs)(a,"commodity_".concat(n,"_data.xlsx"))}catch(e){(0,v.n7)("Error while exporting")}};(0,l.useEffect)((()=>{((e,t)=>{const l=null===i||void 0===i?void 0:i.filter((e=>e.commodity._id===n));if(e){const e=null===l||void 0===l?void 0:l.filter((e=>e.effective_date===t));k(e||[])}else k(l||[]);b(!1)})(null,"")}),[n]);const U=[{title:"S/N",dataIndex:"number",width:80,key:"number",align:"center",render:(e,t,i)=>i+1},{title:"Commodity",dataIndex:"commodity",align:"left",key:"name",width:150,render:e=>(0,w.jsx)("div",{style:{height:"40px",display:"flex",alignItems:"center"},children:(null===e||void 0===e?void 0:e.name)||""})},{title:"Price",dataIndex:"new_price",align:"left",key:"current_price",width:150,render:e=>(0,w.jsx)("div",{style:{height:"40px",display:"flex",alignItems:"center"},children:null===e||void 0===e?void 0:e.toLocaleString()})},{title:"Date",dataIndex:"effective_date",align:"left",width:150,key:"effective_date",render:e=>(0,w.jsx)("div",{style:{height:"40px",display:"flex",alignItems:"center"},children:e})},{title:"Time",dataIndex:"effective_time",align:"left",width:150,key:"effective_date",render:e=>(0,w.jsx)("div",{style:{height:"40px",display:"flex",alignItems:"center"},children:e})}],X=(0,l.useMemo)((()=>{if(!B)return[];const e=Array(12).fill(0),t=null===i||void 0===i?void 0:i.filter((e=>e.commodity._id===n));if(!t)return[];t.forEach((t=>{const i=new Date(t.effective_date).getMonth();e[i]++}));return[{name:B,data:e}]}),[n,B,i,T]);return(0,w.jsxs)("div",{children:[(0,w.jsxs)(d.Ay,{onClick:()=>{L(-1)},type:"text",className:"w-30 h-10 mb-6",style:{background:"#65812729",color:"black",borderRadius:"50px",boxShadow:"none"},children:["Back"," "]}),(0,w.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,w.jsxs)("div",{className:"flex flex-col sm:flex-row items-end w-[600px] sm:gap-8 mt-8",children:[(0,w.jsx)("div",{className:"flex w-[600px] sm:mt-8",children:(0,w.jsx)(a.A,{className:"w-[100px]",onChange:e=>h(e),placeholder:"Commodity",style:{backgroundColor:"#EBE9E9",borderRadius:0,minWidth:"200px"},children:null===t||void 0===t?void 0:t.map(((e,t)=>(0,w.jsx)(a.A.Option,{value:e._id,children:null===e||void 0===e?void 0:e.name},e._id)))})}),(0,w.jsx)("div",{className:"flex w-[600px] mt-4 sm:mt-8",children:(0,w.jsx)(a.A,{className:"w-[100px]",onChange:e=>{const t=null===i||void 0===i?void 0:i.filter((e=>e.commodity._id===n));if(M(t),e){const i=null===t||void 0===t?void 0:t.filter((t=>new Date(t.effective_date).getFullYear()===e));I(i||[])}else k(t||[])},placeholder:"Year",style:{backgroundColor:"#EBE9E9",borderRadius:0,minWidth:"200px"},children:P.map((e=>(0,w.jsx)(a.A.Option,{value:e,children:e},e)))})}),(0,w.jsxs)("div",{className:"flex w-[600px] mt-4 sm:mt-8",children:[(0,w.jsx)(a.A,{className:"w-[100px]",onChange:e=>{const t=N;if(e){const i=T.indexOf(e),l=null===t||void 0===t?void 0:t.filter((e=>new Date(e.effective_date).getMonth()===i));k(l||[])}else k(t||[])},placeholder:"Month",style:{backgroundColor:"#EBE9E9",borderRadius:0,minWidth:"200px"},children:J.map((e=>(0,w.jsx)(a.A.Option,{value:e,children:e},e)))})," "]}),(0,w.jsx)("div",{className:"flex w-[600px] mt-4 sm:mt-8",children:(0,w.jsx)(s.A,{menu:{items:[{key:"pdf",label:"Export as PDF"},{key:"xlsx",label:"Export as XLSX"}],onClick:e=>{let{key:t}=e;A(t),C(!0)}},trigger:["click"],children:(0,w.jsx)(d.Ay,{style:{fontSize:"1rem"},children:"Export"})})}),(0,w.jsx)("div",{className:"flex w-[600px] mt-4 sm:mt-8",children:(0,w.jsx)(d.Ay,{onClick:()=>{k(D||[]),I([]),k([]),O("")},children:"Reset"})})]}),(0,w.jsx)("div",{className:"p-10 bg-white w-full flex items-center justify-center",children:(0,w.jsx)(o.A,{xs:24,sm:24,md:24,lg:24,children:n?(0,w.jsx)(w.Fragment,{children:(0,w.jsx)("div",{style:{margin:5},className:"sm:px-20 bg-white w-full flex items-center justify-center",children:(0,w.jsxs)(o.A,{xs:24,sm:24,md:24,lg:24,children:[(0,w.jsx)("div",{id:"line-chart",children:(0,w.jsx)(m.bl,{data:X})}),(0,w.jsx)("div",{id:"table",className:"mt-10",children:(0,w.jsx)(r.A,{columns:U,rowKey:"_id",dataSource:_,size:"middle"})})]})})}):(0,w.jsx)(o.A,{xs:24,sm:24,md:24,lg:24,children:(0,w.jsx)("div",{className:"p-48 bg-white w-full flex items-center justify-center",children:(0,w.jsx)("p",{children:"Select a Commodity"})})})})})]})]})},b=()=>(0,w.jsx)(n.A,{pageTitle:"Reporting",children:(0,w.jsx)(j,{})})}}]);
//# sourceMappingURL=8474.3db20720.chunk.js.map